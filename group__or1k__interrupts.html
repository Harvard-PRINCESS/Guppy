<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Barrelfish: OR1K interrupt control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Barrelfish
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">OR1K interrupt control</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga87395bad8a48ebc1ed9d44dcfd6c2754"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__or1k__interrupts.html#ga87395bad8a48ebc1ed9d44dcfd6c2754">or1k_interrupt_handler_fptr</a>) (void *data)</td></tr>
<tr class="separator:ga87395bad8a48ebc1ed9d44dcfd6c2754"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gae8d1315878d7641cf6840d16a73e94a5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__or1k__interrupts.html#gae8d1315878d7641cf6840d16a73e94a5">or1k_interrupt_handler_add</a> (uint32_t line, <a class="el" href="group__or1k__interrupts.html#ga87395bad8a48ebc1ed9d44dcfd6c2754">or1k_interrupt_handler_fptr</a> handler, void *data)</td></tr>
<tr class="separator:gae8d1315878d7641cf6840d16a73e94a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gace2e505048c2d8a77521e4bf5bc03967"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__or1k__interrupts.html#gace2e505048c2d8a77521e4bf5bc03967">or1k_interrupt_enable</a> (int line)</td></tr>
<tr class="separator:gace2e505048c2d8a77521e4bf5bc03967"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0f0f3a574dde52175eabace4aaaec34a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__or1k__interrupts.html#ga0f0f3a574dde52175eabace4aaaec34a">or1k_interrupt_disable</a> (int line)</td></tr>
<tr class="separator:ga0f0f3a574dde52175eabace4aaaec34a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6596faf65911ecbcc9881937971946f3"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__or1k__interrupts.html#ga6596faf65911ecbcc9881937971946f3">or1k_interrupts_disable</a> (void)</td></tr>
<tr class="separator:ga6596faf65911ecbcc9881937971946f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga344fd4bd73d40748de810eda21f0f47c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__or1k__interrupts.html#ga344fd4bd73d40748de810eda21f0f47c">or1k_interrupts_enable</a> (void)</td></tr>
<tr class="separator:ga344fd4bd73d40748de810eda21f0f47c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga678519bbf7a7fe2efe99f1b4c7a8da18"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__or1k__interrupts.html#ga678519bbf7a7fe2efe99f1b4c7a8da18">or1k_interrupts_restore</a> (uint32_t status)</td></tr>
<tr class="separator:ga678519bbf7a7fe2efe99f1b4c7a8da18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga462a422517814502521357cf937f0684"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__or1k__interrupts.html#ga462a422517814502521357cf937f0684">or1k_critical_begin</a> ()</td></tr>
<tr class="separator:ga462a422517814502521357cf937f0684"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga470956270188c5ebf719a2cc499c82b7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__or1k__interrupts.html#ga470956270188c5ebf719a2cc499c82b7">or1k_critical_end</a> (uint32_t restore)</td></tr>
<tr class="separator:ga470956270188c5ebf719a2cc499c82b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Interrupt control function prototypes </p>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ga87395bad8a48ebc1ed9d44dcfd6c2754"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* or1k_interrupt_handler_fptr) (void *data)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function pointer to interrupt handler functions </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga462a422517814502521357cf937f0684"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t or1k_critical_begin </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Disable timer and interrupt exception</p>
<p>This function disables the timer and interrupt exception to guard critical sections. It returns the status of the enable bits before the critical section, that is restored with <a class="el" href="group__or1k__interrupts.html#ga470956270188c5ebf719a2cc499c82b7">or1k_critical_end()</a>.</p>
<p>Example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;...</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;uint32_t status = or1k_critical_start();</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;// critical part</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;or1k_critical_end(status);</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;...</div></div><!-- fragment --><dl class="section return"><dt>Returns</dt><dd>Status of timer and interrupt exception at time of call </dd></dl>

</div>
</div>
<a class="anchor" id="ga470956270188c5ebf719a2cc499c82b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void or1k_critical_end </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>restore</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enable timer and interrupt exception</p>
<p>Restore the timer and interrupt exception enable. The restore value is the return value from or1k_critical_start().</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">restore</td><td>Interrupt and timer exception enable restore value </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga0f0f3a574dde52175eabace4aaaec34a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void or1k_interrupt_disable </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Disable interrupts from a given line</p>
<p>Mask given interrupt line. It can be unmasked using <a class="el" href="group__or1k__interrupts.html#gace2e505048c2d8a77521e4bf5bc03967">or1k_interrupt_enable()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">line</td><td>Interrupt line to disable </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gace2e505048c2d8a77521e4bf5bc03967"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void or1k_interrupt_enable </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enable interrupts from a given line</p>
<p>Unmask the given interrupt line. It is also important to enable interrupts in general, e.g., using <a class="el" href="group__or1k__interrupts.html#ga344fd4bd73d40748de810eda21f0f47c">or1k_interrupts_enable()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">line</td><td>Interrupt line to enable </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gae8d1315878d7641cf6840d16a73e94a5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void or1k_interrupt_handler_add </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__or1k__interrupts.html#ga87395bad8a48ebc1ed9d44dcfd6c2754">or1k_interrupt_handler_fptr</a>&#160;</td>
          <td class="paramname"><em>handler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add interrupt handler for interrupt line</p>
<p>Registers a callback function for a certain interrupt line.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">line</td><td>Interrupt line/id to register a handler for </td></tr>
    <tr><td class="paramname">handler</td><td>Handler to register </td></tr>
    <tr><td class="paramname">data</td><td>Data value passed to the handler </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga6596faf65911ecbcc9881937971946f3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t or1k_interrupts_disable </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Disable interrupts</p>
<p>This disables the interrupt exception. This is sufficient to disable all interrupts. It does not change the mask register (which is modified using <a class="el" href="group__or1k__interrupts.html#gace2e505048c2d8a77521e4bf5bc03967">or1k_interrupt_enable()</a> and <a class="el" href="group__or1k__interrupts.html#ga0f0f3a574dde52175eabace4aaaec34a">or1k_interrupt_disable()</a>).</p>
<p>The interrupt exception can be enabled using <a class="el" href="group__or1k__interrupts.html#ga344fd4bd73d40748de810eda21f0f47c">or1k_interrupts_enable()</a>.</p>
<p>Finally, the status of the interrupt exception enable flag is returned by this function. That allows to call this function even if interrupts are already disabled. To restore the value of the interrupt exception enable flag, use the <a class="el" href="group__or1k__interrupts.html#ga678519bbf7a7fe2efe99f1b4c7a8da18">or1k_interrupts_restore()</a> function. That way you avoid to accidentally enable interrupts. Example:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;void f() {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  uint32_t interrupt_status = or1k_interrupts_disable();</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  // do something</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  or1k_interrupts_restore(status);</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;}</div></div><!-- fragment --><p>This code will preserve the original status of the interrupt enable flag.</p>
<dl class="section return"><dt>Returns</dt><dd>Interrupt exception enable flag before call </dd></dl>

</div>
</div>
<a class="anchor" id="ga344fd4bd73d40748de810eda21f0f47c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void or1k_interrupts_enable </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enable interrupt exception</p>
<p>Enable the interrupt exception. Beside the interrupt exception, it is also necessary to enable the individual interrupt lines using <a class="el" href="group__or1k__interrupts.html#gace2e505048c2d8a77521e4bf5bc03967">or1k_interrupt_enable()</a>.</p>
<p>You should avoid using this function together with <a class="el" href="group__or1k__interrupts.html#ga6596faf65911ecbcc9881937971946f3">or1k_interrupts_disable()</a> to guard atomic blocks as it unconditionally enables the interrupt exception (see documentation of <a class="el" href="group__or1k__interrupts.html#ga6596faf65911ecbcc9881937971946f3">or1k_interrupts_disable()</a>). </p>

</div>
</div>
<a class="anchor" id="ga678519bbf7a7fe2efe99f1b4c7a8da18"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void or1k_interrupts_restore </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>status</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Restore interrupt exception enable flag</p>
<p>This function restores the given status to the processor. or1k_interrupts_restore(0) is identical to <a class="el" href="group__or1k__interrupts.html#ga6596faf65911ecbcc9881937971946f3">or1k_interrupts_disable()</a> and or1k_interrupts_restore(SPR_SR_IEE) is identical to <a class="el" href="group__or1k__interrupts.html#ga344fd4bd73d40748de810eda21f0f47c">or1k_interrupts_enable()</a>.</p>
<p>It is for example used to guard an atomic block and restore the original status of the interrupt exception enable flag as returned by <a class="el" href="group__or1k__interrupts.html#ga6596faf65911ecbcc9881937971946f3">or1k_interrupts_disable()</a>. See the documentation of <a class="el" href="group__or1k__interrupts.html#ga6596faf65911ecbcc9881937971946f3">or1k_interrupts_disable()</a> for a usage example.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">status</td><td>Status of the flag to restore </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
