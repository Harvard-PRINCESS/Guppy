<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Barrelfish: lib/elf/elf32.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Barrelfish
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_fb48908d0eb50026d0e4554c438cf048.html">elf</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">elf32.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Rudimentary ELF32 loader and handling routines.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a53c46574f47bc024185fea22dc96432b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a53c46574f47bc024185fea22dc96432b"></a>
genvaddr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="elf32_8c.html#a53c46574f47bc024185fea22dc96432b">elf_virtual_base32</a> (struct <a class="el" href="structElf32__Ehdr.html">Elf32_Ehdr</a> *ehead)</td></tr>
<tr class="memdesc:a53c46574f47bc024185fea22dc96432b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the base of the loadable portion of the elf image in virtual memory. <br /></td></tr>
<tr class="separator:a53c46574f47bc024185fea22dc96432b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a898fcfb65a0b7cb013bcc40804ff139d"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structElf32__Shdr.html">Elf32_Shdr</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="elf32_8c.html#a898fcfb65a0b7cb013bcc40804ff139d">elf32_find_section_header_type</a> (struct <a class="el" href="structElf32__Shdr.html">Elf32_Shdr</a> *shdr, uint32_t entries, uint32_t type)</td></tr>
<tr class="memdesc:a898fcfb65a0b7cb013bcc40804ff139d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return pointer to relocation section ELF header.  <a href="#a898fcfb65a0b7cb013bcc40804ff139d">More...</a><br /></td></tr>
<tr class="separator:a898fcfb65a0b7cb013bcc40804ff139d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e12250504841cdda9cbbfcf73bdd2ae"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structElf32__Shdr.html">Elf32_Shdr</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="elf32_8c.html#a3e12250504841cdda9cbbfcf73bdd2ae">elf32_find_section_header_name</a> (genvaddr_t elf_base, size_t elf_bytes, const char *section_name)</td></tr>
<tr class="memdesc:a3e12250504841cdda9cbbfcf73bdd2ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return pointer to section header with given name.  <a href="#a3e12250504841cdda9cbbfcf73bdd2ae">More...</a><br /></td></tr>
<tr class="separator:a3e12250504841cdda9cbbfcf73bdd2ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa004406b9b659f5c9688a577a3631f62"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structElf32__Sym.html">Elf32_Sym</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="elf32_8c.html#aa004406b9b659f5c9688a577a3631f62">elf32_find_symbol_by_name</a> (genvaddr_t elf_base, size_t elf_bytes, const char *name, uint8_t contains, uint8_t type, uintptr_t *sindex)</td></tr>
<tr class="memdesc:aa004406b9b659f5c9688a577a3631f62"><td class="mdescLeft">&#160;</td><td class="mdescRight">finds the symbol by name  <a href="#aa004406b9b659f5c9688a577a3631f62">More...</a><br /></td></tr>
<tr class="separator:aa004406b9b659f5c9688a577a3631f62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa30ad52d8537d3c21d33374e34746376"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structElf32__Sym.html">Elf32_Sym</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="elf32_8c.html#aa30ad52d8537d3c21d33374e34746376">elf32_find_symbol_by_addr</a> (genvaddr_t elf_base, size_t elf_bytes, lvaddr_t addr, uintptr_t *sindex)</td></tr>
<tr class="memdesc:aa30ad52d8537d3c21d33374e34746376"><td class="mdescLeft">&#160;</td><td class="mdescRight">finds the symbol by its address  <a href="#aa30ad52d8537d3c21d33374e34746376">More...</a><br /></td></tr>
<tr class="separator:aa30ad52d8537d3c21d33374e34746376"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf4159739aef5f69eece9eb36b5042c0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="elf32_8c.html#abf4159739aef5f69eece9eb36b5042c0">elf32_relocate</a> (genvaddr_t dst, genvaddr_t src, struct <a class="el" href="structElf32__Rel.html">Elf32_Rel</a> *rel, size_t size, struct <a class="el" href="structElf32__Sym.html">Elf32_Sym</a> *symtab, size_t symsize, genvaddr_t start, void *vbase)</td></tr>
<tr class="memdesc:abf4159739aef5f69eece9eb36b5042c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Relocates the ELF image from src to dst.  <a href="#abf4159739aef5f69eece9eb36b5042c0">More...</a><br /></td></tr>
<tr class="separator:abf4159739aef5f69eece9eb36b5042c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fbbd04e8d3bf9d24091cd6ae1f2569e"><td class="memItemLeft" align="right" valign="top">errval_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="elf32_8c.html#a1fbbd04e8d3bf9d24091cd6ae1f2569e">elf32_load</a> (uint16_t em_machine, elf_allocator_fn allocate_func, void *state, lvaddr_t base, size_t size, genvaddr_t *retentry, genvaddr_t *ret_tlsbase, size_t *ret_tlsinitlen, size_t *ret_tlstotallen)</td></tr>
<tr class="memdesc:a1fbbd04e8d3bf9d24091cd6ae1f2569e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load ELF32 binary image into memory.  <a href="#a1fbbd04e8d3bf9d24091cd6ae1f2569e">More...</a><br /></td></tr>
<tr class="separator:a1fbbd04e8d3bf9d24091cd6ae1f2569e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Rudimentary ELF32 loader and handling routines. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a3e12250504841cdda9cbbfcf73bdd2ae"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structElf32__Shdr.html">Elf32_Shdr</a>* elf32_find_section_header_name </td>
          <td>(</td>
          <td class="paramtype">genvaddr_t&#160;</td>
          <td class="paramname"><em>elf_base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>elf_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>section_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return pointer to section header with given name. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">elf_base</td><td>Address of ELF header </td></tr>
    <tr><td class="paramname">elf_bytes</td><td>Size of ELF file. </td></tr>
    <tr><td class="paramname">section_name</td><td>Named section to look for.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to ELF section header with name, or NULL. </dd></dl>

</div>
</div>
<a class="anchor" id="a898fcfb65a0b7cb013bcc40804ff139d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structElf32__Shdr.html">Elf32_Shdr</a>* elf32_find_section_header_type </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structElf32__Shdr.html">Elf32_Shdr</a> *&#160;</td>
          <td class="paramname"><em>shdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>entries</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return pointer to relocation section ELF header. </p>
<p>This function finds and returns a pointer to the first ELF section header of type 'type'.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">shdr</td><td>Pointer to head of ELF section header table. </td></tr>
    <tr><td class="paramname">entries</td><td>Number of entries in the ELF section header table. </td></tr>
    <tr><td class="paramname">type</td><td>ELF section header type to look for.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to first ELF section header of type 'type', or NULL. </dd></dl>

</div>
</div>
<a class="anchor" id="aa30ad52d8537d3c21d33374e34746376"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structElf32__Sym.html">Elf32_Sym</a>* elf32_find_symbol_by_addr </td>
          <td>(</td>
          <td class="paramtype">genvaddr_t&#160;</td>
          <td class="paramname"><em>elf_base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>elf_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">lvaddr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t *&#160;</td>
          <td class="paramname"><em>sindex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>finds the symbol by its address </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">elf_base</td><td>virtual address where the elf image is mapped </td></tr>
    <tr><td class="paramname">elf_bytes</td><td>size of the mapped elf image </td></tr>
    <tr><td class="paramname">addr</td><td>virtual address of the symbol </td></tr>
    <tr><td class="paramname">index</td><td>returns the index of the symbol</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the symbol NULL if there is none </dd></dl>

</div>
</div>
<a class="anchor" id="aa004406b9b659f5c9688a577a3631f62"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structElf32__Sym.html">Elf32_Sym</a>* elf32_find_symbol_by_name </td>
          <td>(</td>
          <td class="paramtype">genvaddr_t&#160;</td>
          <td class="paramname"><em>elf_base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>elf_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>contains</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t *&#160;</td>
          <td class="paramname"><em>sindex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>finds the symbol by name </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">elf_base</td><td>virtual address where the elf image is mapped </td></tr>
    <tr><td class="paramname">elf_bytes</td><td>size of the mapped elf image </td></tr>
    <tr><td class="paramname">name</td><td>name of the symbol to look for </td></tr>
    <tr><td class="paramname">contains</td><td>if non zero, search for containing rather than exact match </td></tr>
    <tr><td class="paramname">type</td><td>type of the symbol STT_* </td></tr>
    <tr><td class="paramname">sindex</td><td>index where to start and returns the index of the symbol</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the symbol NULL if there is none </dd></dl>

</div>
</div>
<a class="anchor" id="a1fbbd04e8d3bf9d24091cd6ae1f2569e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">errval_t elf32_load </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>em_machine</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">elf_allocator_fn&#160;</td>
          <td class="paramname"><em>allocate_func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">lvaddr_t&#160;</td>
          <td class="paramname"><em>base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">genvaddr_t *&#160;</td>
          <td class="paramname"><em>retentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">genvaddr_t *&#160;</td>
          <td class="paramname"><em>ret_tlsbase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>ret_tlsinitlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>ret_tlstotallen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load ELF32 binary image into memory. </p>
<p>This function loads an ELF32 binary image, based at 'base' and of size 'size' into the memory provided by 'allocate'</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">em_machine</td><td>ELF machine type. </td></tr>
    <tr><td class="paramname">allocate</td><td>Memory allocation function. </td></tr>
    <tr><td class="paramname">state</td><td>Pointer to state for allocation function. </td></tr>
    <tr><td class="paramname">base</td><td>Base address of ELF32 binary image in memory. </td></tr>
    <tr><td class="paramname">size</td><td>Size of ELF32 binary image in bytes. </td></tr>
    <tr><td class="paramname">retentry</td><td>Used to return entry point address </td></tr>
    <tr><td class="paramname">ret_tlsbase</td><td>Used to return TLS block base address </td></tr>
    <tr><td class="paramname">ret_tlsinitlen</td><td>Used to return length of initialised TLS data block </td></tr>
    <tr><td class="paramname">ret_tlstotallen</td><td>Used to return total length of TLS data </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="abf4159739aef5f69eece9eb36b5042c0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void elf32_relocate </td>
          <td>(</td>
          <td class="paramtype">genvaddr_t&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">genvaddr_t&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structElf32__Rel.html">Elf32_Rel</a> *&#160;</td>
          <td class="paramname"><em>rel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structElf32__Sym.html">Elf32_Sym</a> *&#160;</td>
          <td class="paramname"><em>symtab</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>symsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">genvaddr_t&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>vbase</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Relocates the ELF image from src to dst. </p>
<p>This function processes the ELF relocation section 'rela' of size 'size' of the ELF image, formerly located at 'src', to the new location 'dst'. Relocation is necessary for certain variables that cannot be coded as position-independent code.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dst</td><td>Address to relocate to. </td></tr>
    <tr><td class="paramname">src</td><td>Former base address of the ELF image. </td></tr>
    <tr><td class="paramname">rela</td><td>Pointer to relocation section of the ELF image. </td></tr>
    <tr><td class="paramname">size</td><td>Size in bytes of the ELF relocation section. </td></tr>
    <tr><td class="paramname">symtab</td><td>Pointer to ELF symbol table. </td></tr>
    <tr><td class="paramname">symsize</td><td>Size in bytes of the ELF symbol table. </td></tr>
    <tr><td class="paramname">start</td><td>Original base address of the ELF image. </td></tr>
    <tr><td class="paramname">vbase</td><td>Pointer to ELF image in virtual memory. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
