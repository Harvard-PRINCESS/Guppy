<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Barrelfish: kernel/include/target/x86_64/offsets_target.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Barrelfish
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li><li class="navelem"><a class="el" href="dir_009f605b833ac4622acd6c3c0c26c0f0.html">include</a></li><li class="navelem"><a class="el" href="dir_891a2dd2d9ba19829dc14c879b117587.html">target</a></li><li class="navelem"><a class="el" href="dir_03e155790ae88852b0eb6ac5fae03045.html">x86_64</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">offsets_target.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>X86-64 address space sizes and offsets.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1f00c529bff431402561e54546714d3f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#a1f00c529bff431402561e54546714d3f">X86_64_VADDR_SPACE_BITS</a>&#160;&#160;&#160;48</td></tr>
<tr class="separator:a1f00c529bff431402561e54546714d3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4be3671b9333f6a3a41130d7934702f2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#a4be3671b9333f6a3a41130d7934702f2">X86_64_PADDR_SPACE_BITS</a>&#160;&#160;&#160;48</td></tr>
<tr class="separator:a4be3671b9333f6a3a41130d7934702f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe1fde82f7d4f4ea470d359ef799f5cf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#abe1fde82f7d4f4ea470d359ef799f5cf">X86_64_START_KERNEL_PHYS</a>&#160;&#160;&#160;0x100000</td></tr>
<tr class="separator:abe1fde82f7d4f4ea470d359ef799f5cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6d6a33df902ded1d256f5eb3dde3974"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#ab6d6a33df902ded1d256f5eb3dde3974">X86_64_KERNEL_STACK_SIZE</a>&#160;&#160;&#160;0x4000</td></tr>
<tr class="separator:ab6d6a33df902ded1d256f5eb3dde3974"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec8027788987de62005953b6389e4367"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#aec8027788987de62005953b6389e4367">X86_64_PADDR_SPACE_LIMIT</a>&#160;&#160;&#160;((genpaddr_t)1 &lt;&lt; 40)</td></tr>
<tr class="separator:aec8027788987de62005953b6389e4367"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6903bf329af498efaf3dbe1541d9b4c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#ae6903bf329af498efaf3dbe1541d9b4c">X86_64_INIT_SPACE_LIMIT</a>&#160;&#160;&#160;(32 * 1024 * 1024)</td></tr>
<tr class="separator:ae6903bf329af498efaf3dbe1541d9b4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa056c797f0f1a20228ff7e3e73a82822"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#aa056c797f0f1a20228ff7e3e73a82822">X86_64_INIT_VBASE</a>&#160;&#160;&#160;0x200000</td></tr>
<tr class="separator:aa056c797f0f1a20228ff7e3e73a82822"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa81fbdd247ecbcfcd13d8abf2579a025"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#aa81fbdd247ecbcfcd13d8abf2579a025">X86_64_KERNEL_INIT_MEMORY</a>&#160;&#160;&#160;(1 * 1024 * 1024)</td></tr>
<tr class="separator:aa81fbdd247ecbcfcd13d8abf2579a025"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e91566a96c1505eede1b52b58deda82"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#a2e91566a96c1505eede1b52b58deda82">X86_64_PML4_ALIGN</a>(addr)&#160;&#160;&#160;((addr) &amp; ((genpaddr_t)0x7fffff &lt;&lt; 41))</td></tr>
<tr class="separator:a2e91566a96c1505eede1b52b58deda82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa54a1ea300dec0ca6c482a78665c8472"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#aa54a1ea300dec0ca6c482a78665c8472">X86_64_MEMORY_OFFSET</a>&#160;&#160;&#160;<a class="el" href="x86__64_2offsets__target_8h.html#a2e91566a96c1505eede1b52b58deda82">X86_64_PML4_ALIGN</a>(-<a class="el" href="x86__64_2offsets__target_8h.html#aec8027788987de62005953b6389e4367">X86_64_PADDR_SPACE_LIMIT</a>)</td></tr>
<tr class="separator:aa54a1ea300dec0ca6c482a78665c8472"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3480098612949cfb162e43b1579dc540"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#a3480098612949cfb162e43b1579dc540">X86_64_REAL_MODE_SEGMENT</a>&#160;&#160;&#160;0x0600</td></tr>
<tr class="separator:a3480098612949cfb162e43b1579dc540"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38d799434f662649bc383c173ddf5a34"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#a38d799434f662649bc383c173ddf5a34">X86_64_REAL_MODE_OFFSET</a>&#160;&#160;&#160;0x0000</td></tr>
<tr class="separator:a38d799434f662649bc383c173ddf5a34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a895892c20c4523d8e53b57e449114e00"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#a895892c20c4523d8e53b57e449114e00">X86_64_REAL_MODE_LINEAR_OFFSET</a>&#160;&#160;&#160;(<a class="el" href="x86__64_2offsets__target_8h.html#a3480098612949cfb162e43b1579dc540">X86_64_REAL_MODE_SEGMENT</a> &lt;&lt; 4)</td></tr>
<tr class="separator:a895892c20c4523d8e53b57e449114e00"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:acaf7951da32f5e4d731708bf9213640a"><td class="memItemLeft" align="right" valign="top">uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="x86__64_2offsets__target_8h.html#acaf7951da32f5e4d731708bf9213640a">x86_64_kernel_stack</a> [<a class="el" href="x86__64_2offsets__target_8h.html#ab6d6a33df902ded1d256f5eb3dde3974">X86_64_KERNEL_STACK_SIZE</a>/sizeof(uintptr_t)]</td></tr>
<tr class="memdesc:acaf7951da32f5e4d731708bf9213640a"><td class="mdescLeft">&#160;</td><td class="mdescRight">The kernel stack.  <a href="#acaf7951da32f5e4d731708bf9213640a">More...</a><br /></td></tr>
<tr class="separator:acaf7951da32f5e4d731708bf9213640a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>X86-64 address space sizes and offsets. </p>
<p>The layout of the x86-64 virtual address space can be summarized as follows:</p>
<pre>
 +----------------------------------------------------+-----------------+
 | User-space                                         | Physical memory |
 | PML4 entries: 0 1 2 3 4 ... 510                    | 511             |
 +----------------------------------------------------+-----------------+</pre><p>User-space maps user-space programs. Physical memory maps all available physical memory (up to PADDR_SPACE_LIMIT).</p>
<p>This partition is static and can only be changed at compile-time.</p>
<p>Physical memory can grow downwards, towards user-space, although it is expected to stay within PML4 entry 511 for quite some time (one PML4 entry can map 512 GBytes). The rest of the address space can be freely mapped by (possibly multiple) user-space programs. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ae6903bf329af498efaf3dbe1541d9b4c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_INIT_SPACE_LIMIT&#160;&#160;&#160;(32 * 1024 * 1024)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Static address space limit for the init user-space domain. The static space is used to map in code and static data of the init module, as well as all loaded multiboot modules. init can freely allocate dynamic memory as soon as it is running. This is 32 MBytes right now.</p>
<p>You should make this constant a multiple of #BASE_PAGE_SIZE * #PTABLE_SIZE or you'll restrict init's static address space unneccessarily. init's lowest segment should also be based at these multiples or it restricts itself. </p>

</div>
</div>
<a class="anchor" id="aa056c797f0f1a20228ff7e3e73a82822"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_INIT_VBASE&#160;&#160;&#160;0x200000</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Base address of init address space in virtual memory. init should start at 4 MByte. The kernel maps in important structures at 2 MByte. This address should be page-table size aligned (i.e. with 4 KByte pages, a page table maps 2 MBytes. Thus, align it to multiples of 2 MBytes). </p>

</div>
</div>
<a class="anchor" id="aa81fbdd247ecbcfcd13d8abf2579a025"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_KERNEL_INIT_MEMORY&#160;&#160;&#160;(1 * 1024 * 1024)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initial amount of physical memory to map during bootup. The low 1MByte of memory is always expected to be there and has to be specified here at minimum. If you need more during bootup, increase this value. This value is also the amount of memory you <em>expect</em> to be in the system during bootup, or the kernel will crash! </p>

</div>
</div>
<a class="anchor" id="ab6d6a33df902ded1d256f5eb3dde3974"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_KERNEL_STACK_SIZE&#160;&#160;&#160;0x4000</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Kernel stack size &ndash; 16KB </p>

</div>
</div>
<a class="anchor" id="aa54a1ea300dec0ca6c482a78665c8472"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_MEMORY_OFFSET&#160;&#160;&#160;<a class="el" href="x86__64_2offsets__target_8h.html#a2e91566a96c1505eede1b52b58deda82">X86_64_PML4_ALIGN</a>(-<a class="el" href="x86__64_2offsets__target_8h.html#aec8027788987de62005953b6389e4367">X86_64_PADDR_SPACE_LIMIT</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Absolute offset of mapped physical memory within virtual address space. This occupies one or more (usually one) PML4 slots directly before the kernel. This needs to be aligned to PADDR_SPACE_LIMIT.</p>
<p>Change VSPACE_END in lib/barrelfish if you change this. </p>

</div>
</div>
<a class="anchor" id="a4be3671b9333f6a3a41130d7934702f2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_PADDR_SPACE_BITS&#160;&#160;&#160;48</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Absolute size of physical address space. This is also 48-bit. </p>

</div>
</div>
<a class="anchor" id="aec8027788987de62005953b6389e4367"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_PADDR_SPACE_LIMIT&#160;&#160;&#160;((genpaddr_t)1 &lt;&lt; 40)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum physical address space mappable by the kernel. Adjust this for a bigger physical address space. We set this to 40-bit, i.e. 1 TByte. </p>

</div>
</div>
<a class="anchor" id="a2e91566a96c1505eede1b52b58deda82"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_PML4_ALIGN</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">addr</td><td>)</td>
          <td>&#160;&#160;&#160;((addr) &amp; ((genpaddr_t)0x7fffff &lt;&lt; 41))</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Aligns an address to the nearest PML4 entry by masking out lower 41 bits. </p>

</div>
</div>
<a class="anchor" id="a895892c20c4523d8e53b57e449114e00"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_REAL_MODE_LINEAR_OFFSET&#160;&#160;&#160;(<a class="el" href="x86__64_2offsets__target_8h.html#a3480098612949cfb162e43b1579dc540">X86_64_REAL_MODE_SEGMENT</a> &lt;&lt; 4)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The linear offset of the real-mode segment </p>

</div>
</div>
<a class="anchor" id="a38d799434f662649bc383c173ddf5a34"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_REAL_MODE_OFFSET&#160;&#160;&#160;0x0000</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The real-mode offset <em>has to be</em> 0000!! </p>

</div>
</div>
<a class="anchor" id="a3480098612949cfb162e43b1579dc540"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_REAL_MODE_SEGMENT&#160;&#160;&#160;0x0600</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The real-mode addressesThe real-mode segment </p>

</div>
</div>
<a class="anchor" id="abe1fde82f7d4f4ea470d359ef799f5cf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_START_KERNEL_PHYS&#160;&#160;&#160;0x100000</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Start address of kernel image in physical memory. This is passed to the linker also. The bootloader will load us there. </p>

</div>
</div>
<a class="anchor" id="a1f00c529bff431402561e54546714d3f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define X86_64_VADDR_SPACE_BITS&#160;&#160;&#160;48</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Absolute size of virtual address space. This is 48-bit on x86-64 currently, which equals 256 TBytes and allows for 512 PML4 slots, each of which can map 512 GBytes. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="acaf7951da32f5e4d731708bf9213640a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uintptr_t x86_64_kernel_stack[<a class="el" href="x86__64_2offsets__target_8h.html#ab6d6a33df902ded1d256f5eb3dde3974">X86_64_KERNEL_STACK_SIZE</a>/sizeof(uintptr_t)]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The kernel stack. </p>
<p>The kernel stack.</p>
<p>This is the one and only kernel stack for a kernel instance. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
